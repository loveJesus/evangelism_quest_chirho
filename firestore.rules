// For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life. - John 3:16 (KJV)
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection
    match /users/{userId} {
      // Allow a user to read and write their own profile document.
      // 'create' is implicitly covered by 'write'.
      // 'delete' of user profiles is typically handled by admin processes or specific functions, not directly by users.
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Archived conversations subcollection
      match /archivedConversations/{conversationId} {
        // Allow a user to read, create, update, and delete their own archived conversations.
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }

      // Active conversation data subcollection (document ID is fixed as 'current_active_conversation_v1')
      match /activeConversationData/{activeConvDocId} {
         // Allow a user to read, write (create/update), and delete their own active conversation document.
         // Ensure they can only interact with the specific document ID we use.
        allow read, write, delete: if request.auth != null && request.auth.uid == userId && activeConvDocId == "current_active_conversation_v1";
      }
    }

    // Other collections (if any) would go here with their own rules.
    // Example:
    // match /publicContent/{docId} {
    //   allow read: if true; // Anyone can read public content
    //   allow write: if false; // No one can write (or only admins via Admin SDK)
    // }
  }
}
